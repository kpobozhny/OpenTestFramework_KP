package tests;

import org.apache.log4j.Logger;
import org.apache.log4j.PropertyConfigurator;
import org.junit.*;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameterized.Parameters;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import pagesByDriver.Open;
import tools.ConfigData;
import tools.ExcelDriver;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.TimeUnit;

/**
 * Created by kostyap on 7/25/2016.
 */

@RunWith(value = Parameterized.class)
public class test0001_LoginToApp {

    public static WebDriver driver;
    static Open openApp;
    private String userName;
    private String password;

    static Logger log;
    static Map<String, String> data = new HashMap<String, String>();

    public test0001_LoginToApp(
            String userName,
            String password
    ){
        this.userName=userName;
        this.password=password;
    }

    @Parameters
    //public static Collection<Object[]> data() throws IOException
    public static Collection<String[]> data() throws IOException {

        ArrayList<String []> data1 = new ArrayList<String []>() ;
        String [] sa;
        for (int i=1; i<=2; i++){
            data = ExcelDriver.getDataByColumn(ConfigData.getCfgValue("TEST_DATA"), "T01",i);
            sa = new String []{
                    data.get("USERNAME"),
                    data.get("PASSWORD")
            };

            data1.add(sa);
        }
        return data1;
    }

    @BeforeClass
    public static void setUpBeforeClass() throws Exception {
        //in order to use ChromeDriver you need to download chromedriver.exe from https://sites.google.com/a/chromium.org/chromedriver/
        //System.setProperty("webdriver.chrome.driver", "C:\\Installs\\chromedriver\\chromedriver.exe");
        PropertyConfigurator.configure("src/main/resources/files/log4j.properties");
        driver = new FirefoxDriver();


        log = Logger.getLogger(test0001_LoginToApp.class.getName());
        openApp = new Open(driver);
        driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);

        //data = ExcelDriver.getData("src/Test_data.xls", "F07");
        openApp.webActions.openURL(ConfigData.getCfgValue("APP_URL"));
    }

    @Test
    public void test_T01() throws Exception {

        openApp.loginPage.inputUserName(userName);
        openApp.loginPage.inputPassword(password);
        openApp.loginPage.clickLoginButton();
        Assert.assertTrue(openApp.homePage.checkLogoutLinkPresence());
        openApp.homePage.clickLogoutLink();
        Assert.assertTrue(openApp.loginPage.checkLoginButtonPresence());

    }

    @AfterClass
    public static void tearDownAfterClass() {
        driver.quit();
    }
}
